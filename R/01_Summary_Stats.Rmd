---
output: html_document
---


# Water summaries  

## with site 1 - illustrate difference  

```{r}
dat_with1 <- nfm_all %>% 
    filter(is.na(X00.no.sample.taken),
           is.na(X02.no.lengths..reason.unknown)) %>% 
    mutate(year_season = as.factor(paste(year_sampled, season, sep = "_")),
        across(c(collection_id, site, habitat_type, year_sampled, season), as.factor),
        season = fct_relevel(season, "Spring", "Summer", "Fall", "Winter"),
           habitat_type = case_when(habitat_type == "depositional spartina edge" ~ "depositional edge",
                                    TRUE ~ as.character(habitat_type))) %>% 
    relocate(year_season, .after = "season")
```


Need to do something site-wise here, but what?  



## drop site 1  

**Site 1 is excluded from all summary statistics because it was excluded from further analyses.** 

```{r}
# get rid of the 'ones' column though
dat2 <- dat %>% 
    select(-ones) %>% 
    mutate(season = fct_relevel(season, "Spring", "Summer", "Fall", "Winter"),
           habitat_type = case_when(habitat_type == "depositional spartina edge" ~ "depositional edge",
                                    TRUE ~ as.character(habitat_type)))

names(dat2) <- str_replace_all(names(dat2), "_", ".")
```


```{r}
wq_summ <- dat2 %>% 
    select(collection.id:wind.speed.ms) %>% 
    group_by(season, habitat.type) %>% 
    summarize(across(.cols = c(water.temp.c, salinity.ppt, do.mgl),
                     .fns = list(
                         mean = ~ mean(.x, na.rm = TRUE),
                         sd = ~ sd(.x, na.rm = TRUE),
                         median = ~ median(.x, na.rm = TRUE),
                         iqr = ~ IQR(.x, na.rm = TRUE)
                                 ))) %>% 
    mutate(across(.cols = where(is.numeric), ~ round(.x, 1)))
wq_for_table <- wq_summ %>% 
    pivot_longer(-c(season, habitat.type),
                 names_to = c("param", "stat"),
                 names_sep = "_") %>% 
    mutate(param = str_replace_all(param, "\\.", "_")) %>% 
    pivot_wider(names_from = stat,
                values_from = value) %>% 
    arrange(param, season, habitat.type)
```




# Fish summaries  

## Sample Size   

```{r}
dat2 %>% 
    janitor::tabyl(habitat_type, season) 
```


## Number of species  

```{r}

```


## Number of each species caught throughout sampling  

how many times was each caught, and how many individuals were caught  

```{r}
counts <- dat2 %>% 
    select(Abudefduf.saxatilis:Urophycis.floridana) %>% 
    summarize(across(.cols = everything(),
                     .fns = list(timesCaught = ~sum(.x > 0),
                                 nCaught = ~sum(.x)))) %>% 
    pivot_longer(cols = everything(),
                 names_to = c("Species", "thing"),
                 names_sep = "_") %>% 
    mutate(thing = case_when(thing == "timesCaught" ~ "Times_caught",
                             TRUE ~ "n_caught")) %>% 
    pivot_wider(names_from = thing, values_from = value) 

```

# Species Summary tables  

## By habitat, within each season

```{r}
seasonal_summ <- dat2 %>% 
    group_by(season, habitat_type) %>% 
    summarize(across(Abudefduf.saxatilis:Urophycis.floridana, sum)) 
```

```{r}
DT::datatable(seasonal_summ,
              rownames = FALSE,
              extensions = "FixedColumns",
              options = list(
                  scrollX = TRUE,
                  fixedColumns = list(leftColumns = 2)
              ))
```


## By season, overall  

```{r}
seasonal2 <- seasonal_summ %>% 
    group_by(season) %>% 
    summarize(across(Abudefduf.saxatilis:Urophycis.floridana, sum)) 
```

```{r}
DT::datatable(seasonal2,
              rownames = FALSE,
              extensions = "FixedColumns",
              options = list(
                  scrollX = TRUE,
                  fixedColumns = list(leftColumns = 1)
              ))
```


## By habitat, overall  

```{r}
hab_summ <- seasonal_summ %>% 
    group_by(habitat_type) %>% 
    summarize(across(Abudefduf.saxatilis:Urophycis.floridana, sum))
```

```{r}
DT::datatable(hab_summ,
              rownames = FALSE,
              extensions = "FixedColumns",
              options = list(
                  scrollX = TRUE,
                  fixedColumns = list(leftColumns = 1)
              ))
```


### Most frequently caught  

```{r}
counts %>% 
    arrange(desc(Times_caught)) %>% 
    mutate(row_num = row_number()) %>% 
    select(row_num, everything()) %>% 
    filter(row_num <= 30) %>% 
    knitr::kable()
```


### Most abundant  

```{r}
counts %>% 
    arrange(desc(n_caught)) %>% 
    mutate(row_num = row_number()) %>% 
    select(row_num, everything()) %>% 
    filter(row_num <= 30) %>% 
    knitr::kable()
```


## Richness and diversity  

to fill in